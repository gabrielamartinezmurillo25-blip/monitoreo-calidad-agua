<!DOCTYPE html>
<a href="/logout">Cerrar Sesi칩n</a>

<html lang="es">
<head>
    <meta http-equiv="Cache-Control" content="no-store" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <meta charset="UTF-8">
    <title>Usuario - Calidad del Agua</title>

    <!-- Librer칤a de gr치ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<h2>Estado de la Calidad del Agua</h2>

<canvas id="graficoSensores" width="400" height="200"></canvas>

<h3 id="estadoAgua"></h3>

<script>
fetch('/api/sensores')
.then(response => response.json())
.then(data => {

    // Crear gr치fico
    new Chart(document.getElementById('graficoSensores'), {
        type: 'bar',
        data: {
            labels: ['Temperatura (춿C)', 'pH', 'Turbidez (NTU)', 'TDS (ppm)'],
            datasets: [{
                label: 'Mediciones del Sensor',
                data: [
                    data.temperatura,
                    data.ph,
                    data.turbidez,
                    data.tds
                ]
            }]
        }
    });

    // Evaluaci칩n de calidad del agua
    let estado = "游릭 Agua en BUENA calidad";
    
    if (data.ph < 6.5 || data.ph > 8.5 ||
        data.turbidez > 5 ||
        data.tds > 500) {

        estado = "游댮 Agua NO APTA para consumo. Realizar limpieza del tanque.";
    }

    document.getElementById('estadoAgua').innerText = estado;
});
</script>

</body>
</html>
